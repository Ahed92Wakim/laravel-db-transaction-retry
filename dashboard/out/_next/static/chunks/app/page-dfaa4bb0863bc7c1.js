(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{341:function(e,a,s){Promise.resolve().then(s.bind(s,6117))},6117:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return R}});var t=s(7437),r=s(2265),l=s(7625),n=s(5481),c=s(6940),i=s(7059),d=s(2994),o=s(8147),h=s(3263),m=s(4061),u=s(1156),x=s(7031),j=s(1699),b=s(5169),p=s(3574),v=s(407);let N=[{time:"00:00",p95:420,p99:610},{time:"04:00",p95:460,p99:650},{time:"08:00",p95:510,p99:700},{time:"12:00",p95:480,p99:670},{time:"16:00",p95:530,p99:720},{time:"20:00",p95:455,p99:640}],g=[{code:"400",count:36},{code:"401",count:14},{code:"409",count:42},{code:"429",count:58},{code:"500",count:21},{code:"503",count:27}],f=[{name:"Deadlock",value:38},{name:"Lock timeout",value:26},{name:"Network jitter",value:18},{name:"Replica lag",value:12},{name:"Unknown",value:6}],y=[{label:"Recovered",value:"93.8%",delta:"+1.4% success lift",down:!1},{label:"P95 latency",value:"482 ms",delta:"-18 ms",down:!1},{label:"Escalations",value:"7",delta:"+2 incidents",down:!0}],_=["var(--accent)","var(--accent-cool)","var(--accent-gold)","#4d7c8a","#5f6b89"],w=[{label:"1H",value:"1h",windowLabel:"Last hour"},{label:"24H",value:"24h",windowLabel:"Last 24 hours"},{label:"7D",value:"7d",windowLabel:"Last 7 days"},{label:"14D",value:"14d",windowLabel:"Last 14 days"},{label:"30D",value:"30d",windowLabel:"Last 30 days"}],k=e=>{let a=new Date,s=new Date(a);switch(e){case"1h":s.setHours(a.getHours()-1);break;case"24h":default:s.setHours(a.getHours()-24);break;case"7d":s.setDate(a.getDate()-7);break;case"14d":s.setDate(a.getDate()-14);break;case"30d":s.setDate(a.getDate()-30)}return{from:s,to:a}},L="/api/transaction-retry",D=[{label:"Overview",active:!0},{label:"Retry traffic",badge:"Live"},{label:"Queue health",badge:"243"},{label:"Replica lag"},{label:"Alerts",badge:"7",tone:"warn"}],S=[{label:"Primary DB",value:"Stable",tone:"ok"},{label:"Write locks",value:"3 hotspots",tone:"warn"},{label:"Auto throttle",value:"Enabled"}],A=e=>{if(null==e)return"0";if(Array.isArray(e))return e.map(e=>A(e)).join(", ");if("number"==typeof e)return e.toLocaleString();let a=Number(e);return Number.isNaN(a)?e:a.toLocaleString()};function K(e){var a,s;let{active:r,payload:l,label:n}=e;if(!r||!l||0===l.length)return null;let c=null!==(s=null!=n?n:null===(a=l[0])||void 0===a?void 0:a.name)&&void 0!==s?s:"Snapshot";return(0,t.jsxs)("div",{className:"tooltip",children:[(0,t.jsx)("strong",{children:c}),l.map(e=>{var a;return(0,t.jsxs)("div",{children:[e.name,": ",A(null!==(a=e.value)&&void 0!==a?a:0)]},"".concat(e.name,"-").concat(e.value))})]})}function R(){var e;let[a,s]=(0,r.useState)("light"),[R,E]=(0,r.useState)("24h"),[C,O]=(0,r.useState)(null),[W,H]=(0,r.useState)([]),[P,B]=(0,r.useState)("idle"),I=null!==(e=w.find(e=>e.value===R))&&void 0!==e?e:w[1],M=(0,r.useMemo)(()=>k(R),[R]),q=(0,r.useMemo)(()=>new URLSearchParams({from:M.from.toISOString(),to:M.to.toISOString(),window:R}).toString(),[R,M]),F=I.windowLabel,T=I.label;(0,r.useEffect)(()=>{let e=window.localStorage.getItem("dashboard-theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;s("light"===e||"dark"===e?e:a?"dark":"light")},[]),(0,r.useEffect)(()=>{document.documentElement.dataset.theme=a,window.localStorage.setItem("dashboard-theme",a)},[a]),(0,r.useEffect)(()=>{let e=new AbortController;return O(null),(async()=>{try{var a;let s=await fetch("".concat(L,"/metrics/today?").concat(q),{signal:e.signal,headers:{Accept:"application/json"}});if(!s.ok)return;let t=await s.json(),r=Number(null==t?void 0:null===(a=t.data)||void 0===a?void 0:a.total_retries);Number.isNaN(r)||O(r)}catch(e){"AbortError"!==e.name&&O(null)}})(),()=>e.abort()},[q]),(0,r.useEffect)(()=>{let e=new AbortController;return B("loading"),(async()=>{try{let a=await fetch("".concat(L,"/metrics/traffic?").concat(q),{signal:e.signal,headers:{Accept:"application/json"}});if(!a.ok){B("error");return}let s=await a.json();H(Array.isArray(null==s?void 0:s.data)?s.data:[]),B("idle")}catch(e){"AbortError"!==e.name&&B("error")}})(),()=>e.abort()},[q]);let U=[{label:"Total retries",value:null===C?"--":A(C),delta:F,down:!1},...y],G="loading"===P?"Loading traffic...":"error"===P?"Unable to load traffic.":0===W.length?"No retry events in this window.":null;return(0,t.jsxs)("main",{className:"dashboard-shell",children:[(0,t.jsxs)("aside",{className:"sidebar",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"sidebar__brand",children:(0,t.jsx)("div",{children:(0,t.jsx)("p",{className:"sidebar__title",children:"Retry Control"})})}),(0,t.jsx)("nav",{className:"sidebar__nav",children:D.map(e=>(0,t.jsxs)("button",{type:"button",className:"sidebar__item".concat(e.active?" sidebar__item--active":""),children:[(0,t.jsx)("span",{children:e.label}),e.badge?(0,t.jsx)("span",{className:"sidebar__pill".concat("warn"===e.tone?" sidebar__pill--warn":""),children:e.badge}):null]},e.label))})]}),(0,t.jsxs)("div",{className:"sidebar__panel",children:[(0,t.jsxs)("div",{className:"sidebar__panel-header",children:[(0,t.jsx)("span",{children:"System status"}),(0,t.jsx)("button",{type:"button",className:"theme-toggle",onClick:()=>s("dark"===a?"light":"dark"),"aria-pressed":"dark"===a,children:"dark"===a?"Light mode":"Dark mode"})]}),(0,t.jsx)("div",{className:"sidebar__panel-body",children:S.map(e=>(0,t.jsxs)("div",{className:"sidebar__status",children:[(0,t.jsx)("span",{className:"sidebar__status-label",children:e.label}),(0,t.jsx)("span",{className:"sidebar__status-value".concat("ok"===e.tone?" sidebar__status-value--ok":"warn"===e.tone?" sidebar__status-value--warn":""),children:e.value})]},e.label))})]})]}),(0,t.jsxs)("div",{className:"dashboard",children:[(0,t.jsxs)("header",{className:"dashboard-header",children:[(0,t.jsxs)("div",{className:"dashboard-header__intro",children:[(0,t.jsx)("span",{className:"eyebrow",children:"Retry telemetry"}),(0,t.jsx)("h1",{className:"dashboard-header__title",children:"Transaction Retry Command Center"}),(0,t.jsxs)("p",{className:"dashboard-header__subtitle",children:["Window: ",F,". Metrics update across the dashboard."]})]}),(0,t.jsxs)("div",{className:"date-filter",role:"group","aria-label":"Date range",children:[(0,t.jsx)("span",{className:"date-filter__label",children:"Date range"}),(0,t.jsx)("div",{className:"date-filter__options",children:w.map(e=>(0,t.jsx)("button",{type:"button",className:"date-filter__button".concat(e.value===R?" date-filter__button--active":""),onClick:()=>E(e.value),"aria-pressed":e.value===R,children:e.label},e.value))})]})]}),(0,t.jsx)("section",{className:"grid metrics",children:U.map(e=>(0,t.jsxs)("div",{className:"card metric-card",children:[(0,t.jsx)("span",{className:"metric-card__label",children:e.label}),(0,t.jsx)("span",{className:"metric-card__value",children:e.value}),(0,t.jsx)("span",{className:"metric-card__delta".concat(e.down?" metric-card__delta--down":""),children:e.delta})]},e.label))}),(0,t.jsxs)("section",{className:"grid charts",children:[(0,t.jsxs)("div",{className:"card chart-card chart-card--wide",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"Retry traffic"}),(0,t.jsxs)("p",{className:"card-subtitle",children:["Attempts vs recovered transactions - ",F]})]}),(0,t.jsx)("span",{className:"card-chip",children:T})]}),(0,t.jsx)("div",{className:"chart-frame".concat(G?" chart-frame--empty":""),children:G?(0,t.jsx)("p",{className:"chart-empty",children:G}):(0,t.jsx)(l.h,{width:"100%",height:"100%",children:(0,t.jsxs)(n.T,{data:W,margin:{top:10,right:20,left:0,bottom:0},children:[(0,t.jsx)("defs",{children:(0,t.jsxs)("linearGradient",{id:"retryFill",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,t.jsx)("stop",{offset:"5%",stopColor:"var(--accent)",stopOpacity:.4}),(0,t.jsx)("stop",{offset:"95%",stopColor:"var(--accent)",stopOpacity:.05})]})}),(0,t.jsx)(c.q,{stroke:"rgba(15, 23, 42, 0.08)",strokeDasharray:"3 3"}),(0,t.jsx)(i.K,{dataKey:"time",tickLine:!1,axisLine:!1}),(0,t.jsx)(d.B,{tickLine:!1,axisLine:!1}),(0,t.jsx)(o.u,{content:(0,t.jsx)(K,{})}),(0,t.jsx)(h.u,{type:"monotone",dataKey:"attempts",stroke:"var(--accent)",strokeWidth:2,fill:"url(#retryFill)"}),(0,t.jsx)(m.x,{type:"monotone",dataKey:"recovered",stroke:"var(--accent-cool)",strokeWidth:2,dot:!1})]})})}),(0,t.jsxs)("div",{className:"legend",children:[(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"legend-dot"})," Attempts"]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"legend-dot legend-dot--cool"})," Recovered"]})]})]}),(0,t.jsxs)("div",{className:"card chart-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"Latency drift"}),(0,t.jsxs)("p",{className:"card-subtitle",children:["P95 and P99 retry duration (ms) - ",F]})]}),(0,t.jsx)("span",{className:"card-chip",children:T})]}),(0,t.jsx)("div",{className:"chart-frame",children:(0,t.jsx)(l.h,{width:"100%",height:"100%",children:(0,t.jsxs)(u.w,{data:N,margin:{top:10,right:20,left:0,bottom:0},children:[(0,t.jsx)(c.q,{stroke:"rgba(15, 23, 42, 0.08)",strokeDasharray:"3 3"}),(0,t.jsx)(i.K,{dataKey:"time",tickLine:!1,axisLine:!1}),(0,t.jsx)(d.B,{tickLine:!1,axisLine:!1}),(0,t.jsx)(o.u,{content:(0,t.jsx)(K,{})}),(0,t.jsx)(m.x,{type:"monotone",dataKey:"p95",stroke:"var(--accent-cool)",strokeWidth:2,dot:!1}),(0,t.jsx)(m.x,{type:"monotone",dataKey:"p99",stroke:"var(--accent)",strokeWidth:2,dot:!1})]})})}),(0,t.jsx)("p",{className:"chart-footnote",children:"Latency stays within alerting bounds."})]}),(0,t.jsxs)("div",{className:"card chart-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"Failure codes"}),(0,t.jsxs)("p",{className:"card-subtitle",children:["Distribution of error responses - ",F]})]}),(0,t.jsx)("span",{className:"card-chip",children:T})]}),(0,t.jsx)("div",{className:"chart-frame",children:(0,t.jsx)(l.h,{width:"100%",height:"100%",children:(0,t.jsxs)(x.v,{data:g,margin:{top:10,right:20,left:0,bottom:0},children:[(0,t.jsx)(c.q,{stroke:"rgba(15, 23, 42, 0.08)",strokeDasharray:"3 3"}),(0,t.jsx)(i.K,{dataKey:"code",tickLine:!1,axisLine:!1}),(0,t.jsx)(d.B,{tickLine:!1,axisLine:!1}),(0,t.jsx)(o.u,{content:(0,t.jsx)(K,{})}),(0,t.jsx)(j.$,{dataKey:"count",radius:[10,10,4,4],fill:"var(--accent-gold)"})]})})}),(0,t.jsx)("p",{className:"chart-footnote",children:"429 and 409 are trending up."})]}),(0,t.jsxs)("div",{className:"card chart-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"Retry reasons"}),(0,t.jsxs)("p",{className:"card-subtitle",children:["What triggers the backoff - ",F]})]}),(0,t.jsx)("span",{className:"card-chip",children:T})]}),(0,t.jsx)("div",{className:"chart-frame",children:(0,t.jsx)(l.h,{width:"100%",height:"100%",children:(0,t.jsxs)(b.u,{children:[(0,t.jsx)(o.u,{content:(0,t.jsx)(K,{})}),(0,t.jsx)(p.b,{data:f,dataKey:"value",nameKey:"name",innerRadius:55,outerRadius:90,paddingAngle:4,children:f.map((e,a)=>(0,t.jsx)(v.b,{fill:_[a%_.length]},e.name))})]})})}),(0,t.jsx)("div",{className:"legend",children:f.map((e,a)=>(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"legend-dot",style:{background:_[a%_.length]}}),e.name]},e.name))})]})]})]})]})}}},function(e){e.O(0,[879,971,117,744],function(){return e(e.s=341)}),_N_E=e.O()}]);