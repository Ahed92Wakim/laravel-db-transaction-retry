(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},1800,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(75225),r=e.i(9694),n=e.i(72526),i=e.i(55706),l=e.i(83966),o=e.i(85183),c=e.i(93230),d=e.i(44171),m=(0,l.generateCategoricalChart)({chartName:"LineChart",GraphicalChild:i.Line,axisComponents:[{axisType:"xAxis",AxisComp:o.XAxis},{axisType:"yAxis",AxisComp:c.YAxis}],formatAxisMap:d.formatAxisMap}),u=e.i(44098),h=e.i(34239),x=e.i(30908),j=e.i(18074),_=e.i(10284);function p(){let[e,l]=(0,s.useState)(null),[d,p]=(0,s.useState)("24h"),[g,v]=(0,s.useState)([]),[N,y]=(0,s.useState)("idle"),[b,f]=(0,s.useState)([]),[A,C]=(0,s.useState)(null),[k,w]=(0,s.useState)("idle"),L=_.timeRanges.find(e=>e.value===d)??_.timeRanges[1],M=(0,s.useMemo)(()=>(0,_.resolveTimeWindow)(d),[d]),T=(0,s.useMemo)(()=>new URLSearchParams({from:M.from.toISOString(),to:M.to.toISOString(),window:d}).toString(),[d,M]),S=L.windowLabel,D=L.label;(0,s.useEffect)(()=>{"u"<typeof Intl?l("UTC"):l(Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC")},[]),(0,s.useEffect)(()=>{let e=new AbortController;return w("loading"),(async()=>{try{let t=await fetch(`${_.apiBase}/metrics/queries?${T}`,{signal:e.signal,headers:{Accept:"application/json"}});if(!t.ok)return void w("error");let s=await t.json(),a=(Array.isArray(s?.data)?s.data:[]).map(e=>{let t=Number(e.avg_ms??0),s=Number(e.p95_ms??0),a=(0,_.toCount)(e.count??0),r=(0,_.toCount)(e.transaction_count??a),n=(0,_.toCount)(e.under_2s??0),i=(0,_.toCount)(e.over_2s??0),l=null!=e.under_2s||null!=e.over_2s,o=null!=e.transaction_volume,c=(0,_.toCount)(e.transaction_volume??0);return{...e,count:a,transaction_count:r,transaction_volume:l?n+i:o?c:r,avg_ms:Number.isFinite(t)?t:0,p95_ms:Number.isFinite(s)?s:0,under_2s:n,over_2s:i}}),r=(0,_.resolveBucket)(s?.meta?.bucket)??(0,_.bucketForRange)(d);f(a),C(r),w("idle")}catch(e){"AbortError"!==e.name&&w("error")}})(),()=>e.abort()},[T,d]),(0,s.useEffect)(()=>{let e=new AbortController;return y("loading"),(async()=>{try{let t=await fetch(`${_.apiBase}/metrics/routes-volume?${T}&limit=${_.routeMetricsLimit}`,{signal:e.signal,headers:{Accept:"application/json"}});if(!t.ok)return void y("error");let s=await t.json(),a=(Array.isArray(s?.data)?s.data:[]).map(e=>{let t=Number(e.avg_ms??0),s=Number(e.p95_ms??0);return{...e,status_1xx_3xx:(0,_.toCount)(e.status_1xx_3xx??0),status_4xx:(0,_.toCount)(e.status_4xx??0),status_5xx:(0,_.toCount)(e.status_5xx??0),total:(0,_.toCount)(e.total??0),avg_ms:Number.isFinite(t)?t:0,p95_ms:Number.isFinite(s)?s:0}});v(a),y("idle")}catch(e){"AbortError"!==e.name&&y("error")}})(),()=>e.abort()},[T]);let P="loading"===k?"Loading query metrics...":"error"===k?"Unable to load query metrics.":0===b.length?"No query records in this window.":null,R="loading"===N?"Loading routes...":"error"===N?"Unable to load routes.":0===g.length?"No routes recorded in this window.":null,$=(0,s.useMemo)(()=>b.map(t=>({...t,time:(0,_.formatBucketLabel)(t.timestamp,A,e,t.time)})),[e,b,A]),O=(0,s.useMemo)(()=>{let e=b.map(e=>e.transaction_volume??e.transaction_count).filter(e=>Number.isFinite(e));if(0===e.length)return{total:null,peak:null,average:null,under_2s:null,over_2s:null};let t=e.reduce((e,t)=>e+Number(t),0),s=Math.max(...e),a=t/e.length;return{total:t,peak:s,average:a,...b.reduce((e,t)=>({under_2s:e.under_2s+(t.under_2s??0),over_2s:e.over_2s+(t.over_2s??0)}),{under_2s:0,over_2s:0})}},[b]),B=(0,s.useMemo)(()=>{let e=b.map(e=>e.avg_ms).filter(e=>Number.isFinite(e)),t=b.map(e=>e.p95_ms).filter(e=>Number.isFinite(e)),s=e.length>0?e.reduce((e,t)=>e+t,0)/e.length:null,a=t.length>0?t.reduce((e,t)=>e+t,0)/t.length:null;return{minAvg:e.length>0?Math.min(...e):null,maxP95:t.length>0?Math.max(...t):null,avgAvg:s,avgP95:a}},[b]),F=null!=B.minAvg&&null!=B.maxP95?`${(0,_.formatDurationMs)(B.minAvg)} - ${(0,_.formatDurationMs)(B.maxP95)}`:"--";return(0,t.jsxs)(x.default,{timeRange:d,onTimeRangeChange:p,rangeLabel:S,children:[(0,t.jsx)("section",{className:"chart-pair",children:(0,t.jsxs)("div",{className:"chart-pair__grid",children:[(0,t.jsxs)("div",{className:"card chart-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"DB transaction volume"}),(0,t.jsxs)("p",{className:"card-subtitle",children:["Logged transactions by duration - ",S]})]}),(0,t.jsx)("span",{className:"card-chip",children:D})]}),(0,t.jsxs)("div",{className:"chart-summary",children:[(0,t.jsxs)("div",{className:"chart-summary__main",children:[(0,t.jsx)("span",{className:"chart-summary__label",children:"Total transactions"}),(0,t.jsx)("span",{className:"chart-summary__value",children:(0,_.formatOptionalNumber)(O.total)}),(0,t.jsx)("span",{className:"chart-summary__meta",children:S})]}),(0,t.jsxs)("div",{className:"chart-summary__stats",children:[(0,t.jsxs)("div",{className:"chart-summary__stat",children:[(0,t.jsx)("span",{className:"legend-dot legend-dot--cool"}),(0,t.jsx)("span",{children:"< 2s"}),(0,t.jsx)("strong",{children:(0,_.formatOptionalNumber)(O.under_2s)})]}),(0,t.jsxs)("div",{className:"chart-summary__stat",children:[(0,t.jsx)("span",{className:"legend-dot legend-dot--hot"}),(0,t.jsx)("span",{children:"> 2s"}),(0,t.jsx)("strong",{children:(0,_.formatOptionalNumber)(O.over_2s)})]})]})]}),(0,t.jsx)("div",{className:`chart-frame${P?" chart-frame--empty":""}`,children:P?(0,t.jsx)("p",{className:"chart-empty",children:P}):(0,t.jsx)(u.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(r.BarChart,{data:$,margin:{top:10,right:20,left:0,bottom:0},syncId:"query-metrics",syncMethod:"index",children:[(0,t.jsx)(n.CartesianGrid,{stroke:"rgba(15, 23, 42, 0.08)",strokeDasharray:"3 3"}),(0,t.jsx)(o.XAxis,{dataKey:"time",tickLine:!1,axisLine:!1}),(0,t.jsx)(c.YAxis,{tickLine:!1,axisLine:!1}),(0,t.jsx)(h.Tooltip,{content:(0,t.jsx)(j.QueryTooltip,{timeZone:e})}),(0,t.jsx)(a.Bar,{dataKey:"under_2s",name:"<2s",stackId:"duration",fill:"var(--accent-cool)"}),(0,t.jsx)(a.Bar,{dataKey:"over_2s",name:">2s",stackId:"duration",fill:"var(--accent-hot)",radius:[10,10,4,4]})]})})})]}),(0,t.jsxs)("div",{className:"card chart-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"Query duration"}),(0,t.jsxs)("p",{className:"card-subtitle",children:["Avg vs p95 execution time (ms) - ",S]})]}),(0,t.jsx)("span",{className:"card-chip",children:D})]}),(0,t.jsxs)("div",{className:"chart-summary",children:[(0,t.jsxs)("div",{className:"chart-summary__main",children:[(0,t.jsx)("span",{className:"chart-summary__label",children:"Duration range"}),(0,t.jsx)("span",{className:"chart-summary__value",children:F}),(0,t.jsx)("span",{className:"chart-summary__meta",children:S})]}),(0,t.jsxs)("div",{className:"chart-summary__stats",children:[(0,t.jsxs)("div",{className:"chart-summary__stat",children:[(0,t.jsx)("span",{className:"legend-dot legend-dot--cool"}),(0,t.jsx)("span",{children:"Avg"}),(0,t.jsx)("strong",{children:(0,_.formatDurationMs)(B.avgAvg)})]}),(0,t.jsxs)("div",{className:"chart-summary__stat",children:[(0,t.jsx)("span",{className:"legend-dot legend-dot--gold"}),(0,t.jsx)("span",{children:"P95"}),(0,t.jsx)("strong",{children:(0,_.formatDurationMs)(B.avgP95)})]})]})]}),(0,t.jsx)("div",{className:`chart-frame${P?" chart-frame--empty":""}`,children:P?(0,t.jsx)("p",{className:"chart-empty",children:P}):(0,t.jsx)(u.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(m,{data:$,margin:{top:10,right:20,left:0,bottom:0},syncId:"query-metrics",syncMethod:"index",children:[(0,t.jsx)(n.CartesianGrid,{stroke:"rgba(15, 23, 42, 0.08)",strokeDasharray:"3 3"}),(0,t.jsx)(o.XAxis,{dataKey:"time",tickLine:!1,axisLine:!1}),(0,t.jsx)(c.YAxis,{tickLine:!1,axisLine:!1}),(0,t.jsx)(h.Tooltip,{content:(0,t.jsx)(j.QueryTooltip,{timeZone:e}),cursor:{stroke:"var(--border)",strokeWidth:1}}),(0,t.jsx)(i.Line,{type:"monotone",dataKey:"avg_ms",name:"Avg ms",stroke:"var(--accent-cool)",strokeWidth:2,dot:!1,activeDot:{r:4,strokeWidth:2}}),(0,t.jsx)(i.Line,{type:"monotone",dataKey:"p95_ms",name:"P95 ms",stroke:"var(--accent-gold)",strokeWidth:2,dot:!1,activeDot:{r:4,strokeWidth:2}})]})})})]})]})}),(0,t.jsxs)("section",{className:"route-table route-table--compact",children:[(0,t.jsxs)("div",{className:"route-table__header",children:[(0,t.jsx)("p",{className:"route-table__title",children:"Routes"}),(0,t.jsxs)("span",{className:"route-table__meta",children:[D," window"]})]}),R?(0,t.jsx)("p",{className:"route-table__empty",children:R}):(0,t.jsx)("div",{className:"route-table__scroll",children:(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Method"}),(0,t.jsx)("th",{children:"Path"}),(0,t.jsx)("th",{children:"1/2/3xx"}),(0,t.jsx)("th",{children:"4xx"}),(0,t.jsx)("th",{children:"5xx"}),(0,t.jsx)("th",{children:"Total"}),(0,t.jsx)("th",{children:"Avg"}),(0,t.jsx)("th",{children:"P95"})]})}),(0,t.jsx)("tbody",{children:g.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:`route-method route-method--text ${(0,_.methodClassName)(e.method)}`,children:e.method?e.method.toUpperCase():"--"})}),(0,t.jsx)("td",{children:(0,_.formatRouteLabel)(e)}),(0,t.jsx)("td",{children:(0,_.formatValue)(e.status_1xx_3xx??0)}),(0,t.jsx)("td",{children:(0,j.renderStatusCell)(e.status_4xx,"warn")}),(0,t.jsx)("td",{children:(0,j.renderStatusCell)(e.status_5xx,"error")}),(0,t.jsx)("td",{children:(0,_.formatValue)(e.total??0)}),(0,t.jsx)("td",{children:(0,_.formatDurationMs)(e.avg_ms)}),(0,t.jsx)("td",{children:(0,_.formatDurationMs)(e.p95_ms)})]},`volume-${e.method??"method"}-${e.route_name??e.url??"unknown"}`))})]})})]})]})}e.s(["default",()=>p],1800)}]);