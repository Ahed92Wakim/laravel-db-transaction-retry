(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},9694,e=>{"use strict";var t=e.i(83966),a=e.i(75225),s=e.i(85183),r=e.i(93230),i=e.i(44171),n=(0,t.generateCategoricalChart)({chartName:"BarChart",GraphicalChild:a.Bar,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:s.XAxis},{axisType:"yAxis",AxisComp:r.YAxis}],formatAxisMap:i.formatAxisMap});e.s(["BarChart",()=>n])},29228,e=>{"use strict";var t=e.i(83966),a=e.i(55706),s=e.i(85183),r=e.i(93230),i=e.i(44171),n=(0,t.generateCategoricalChart)({chartName:"LineChart",GraphicalChild:a.Line,axisComponents:[{axisType:"xAxis",AxisComp:s.XAxis},{axisType:"yAxis",AxisComp:r.YAxis}],formatAxisMap:i.formatAxisMap});e.s(["LineChart",()=>n])},1800,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75225),r=e.i(9694),i=e.i(72526),n=e.i(55706),l=e.i(29228),o=e.i(44098),c=e.i(34239),d=e.i(85183),m=e.i(93230),u=e.i(30908),h=e.i(18074),x=e.i(10284);function p(){let[e,p]=(0,a.useState)(null),[j,_]=(0,a.useState)("24h"),[v,g]=(0,a.useState)([]),[y,N]=(0,a.useState)("idle"),[b,f]=(0,a.useState)([]),[C,A]=(0,a.useState)(null),[k,w]=(0,a.useState)("idle"),L=x.timeRanges.find(e=>e.value===j)??x.timeRanges[1],M=(0,a.useMemo)(()=>(0,x.resolveTimeWindow)(j),[j]),T=(0,a.useMemo)(()=>new URLSearchParams({from:M.from.toISOString(),to:M.to.toISOString(),window:j}).toString(),[j,M]),S=L.windowLabel,B=L.label;(0,a.useEffect)(()=>{"u"<typeof Intl?p("UTC"):p(Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC")},[]),(0,a.useEffect)(()=>{let e=new AbortController;return w("loading"),(async()=>{try{let t=await fetch(`${x.apiBase}/metrics/queries?${T}`,{signal:e.signal,headers:{Accept:"application/json"}});if(!t.ok)return void w("error");let a=await t.json(),s=(Array.isArray(a?.data)?a.data:[]).map(e=>{let t=Number(e.avg_ms??0),a=Number(e.p95_ms??0),s=(0,x.toCount)(e.count??0),r=(0,x.toCount)(e.transaction_count??s),i=(0,x.toCount)(e.under_2s??0),n=(0,x.toCount)(e.over_2s??0),l=null!=e.under_2s||null!=e.over_2s,o=null!=e.transaction_volume,c=(0,x.toCount)(e.transaction_volume??0);return{...e,count:s,transaction_count:r,transaction_volume:l?i+n:o?c:r,avg_ms:Number.isFinite(t)?t:0,p95_ms:Number.isFinite(a)?a:0,under_2s:i,over_2s:n}}),r=(0,x.resolveBucket)(a?.meta?.bucket)??(0,x.bucketForRange)(j);f(s),A(r),w("idle")}catch(e){"AbortError"!==e.name&&w("error")}})(),()=>e.abort()},[T,j]),(0,a.useEffect)(()=>{let e=new AbortController;return N("loading"),(async()=>{try{let t=await fetch(`${x.apiBase}/metrics/routes-volume?${T}&limit=${x.routeMetricsLimit}`,{signal:e.signal,headers:{Accept:"application/json"}});if(!t.ok)return void N("error");let a=await t.json(),s=(Array.isArray(a?.data)?a.data:[]).map(e=>{let t=Number(e.avg_ms??0),a=Number(e.p95_ms??0);return{...e,status_1xx_3xx:(0,x.toCount)(e.status_1xx_3xx??0),status_4xx:(0,x.toCount)(e.status_4xx??0),status_5xx:(0,x.toCount)(e.status_5xx??0),total:(0,x.toCount)(e.total??0),avg_ms:Number.isFinite(t)?t:0,p95_ms:Number.isFinite(a)?a:0}});g(s),N("idle")}catch(e){"AbortError"!==e.name&&N("error")}})(),()=>e.abort()},[T]);let D="loading"===k?"Loading query metrics...":"error"===k?"Unable to load query metrics.":0===b.length?"No query records in this window.":null,P="loading"===y?"Loading routes...":"error"===y?"Unable to load routes.":0===v.length?"No routes recorded in this window.":null,R=(0,a.useMemo)(()=>b.map(t=>({...t,time:(0,x.formatBucketLabel)(t.timestamp,C,e,t.time)})),[e,b,C]),$=(0,a.useMemo)(()=>{let e=b.map(e=>e.transaction_volume??e.transaction_count).filter(e=>Number.isFinite(e));if(0===e.length)return{total:null,peak:null,average:null,under_2s:null,over_2s:null};let t=e.reduce((e,t)=>e+Number(t),0),a=Math.max(...e),s=t/e.length;return{total:t,peak:a,average:s,...b.reduce((e,t)=>({under_2s:e.under_2s+(t.under_2s??0),over_2s:e.over_2s+(t.over_2s??0)}),{under_2s:0,over_2s:0})}},[b]),O=(0,a.useMemo)(()=>{let e=b.map(e=>e.avg_ms).filter(e=>Number.isFinite(e)),t=b.map(e=>e.p95_ms).filter(e=>Number.isFinite(e)),a=e.length>0?e.reduce((e,t)=>e+t,0)/e.length:null,s=t.length>0?t.reduce((e,t)=>e+t,0)/t.length:null;return{minAvg:e.length>0?Math.min(...e):null,maxP95:t.length>0?Math.max(...t):null,avgAvg:a,avgP95:s}},[b]),F=null!=O.minAvg&&null!=O.maxP95?`${(0,x.formatDurationMs)(O.minAvg)} - ${(0,x.formatDurationMs)(O.maxP95)}`:"--";return(0,t.jsxs)(u.default,{timeRange:j,onTimeRangeChange:_,rangeLabel:S,children:[(0,t.jsx)("section",{className:"chart-pair",children:(0,t.jsxs)("div",{className:"chart-pair__grid",children:[(0,t.jsxs)("div",{className:"card chart-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"DB transaction volume"}),(0,t.jsxs)("p",{className:"card-subtitle",children:["Logged transactions by duration - ",S]})]}),(0,t.jsx)("span",{className:"card-chip",children:B})]}),(0,t.jsxs)("div",{className:"chart-summary",children:[(0,t.jsxs)("div",{className:"chart-summary__main",children:[(0,t.jsx)("span",{className:"chart-summary__label",children:"Total transactions"}),(0,t.jsx)("span",{className:"chart-summary__value",children:(0,x.formatOptionalNumber)($.total)}),(0,t.jsx)("span",{className:"chart-summary__meta",children:S})]}),(0,t.jsxs)("div",{className:"chart-summary__stats",children:[(0,t.jsxs)("div",{className:"chart-summary__stat",children:[(0,t.jsx)("span",{className:"legend-dot legend-dot--cool"}),(0,t.jsx)("span",{children:"< 2s"}),(0,t.jsx)("strong",{children:(0,x.formatOptionalNumber)($.under_2s)})]}),(0,t.jsxs)("div",{className:"chart-summary__stat",children:[(0,t.jsx)("span",{className:"legend-dot legend-dot--hot"}),(0,t.jsx)("span",{children:"> 2s"}),(0,t.jsx)("strong",{children:(0,x.formatOptionalNumber)($.over_2s)})]})]})]}),(0,t.jsx)("div",{className:`chart-frame${D?" chart-frame--empty":""}`,children:D?(0,t.jsx)("p",{className:"chart-empty",children:D}):(0,t.jsx)(o.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(r.BarChart,{data:R,margin:{top:10,right:20,left:0,bottom:0},syncId:"query-metrics",syncMethod:"index",children:[(0,t.jsx)(i.CartesianGrid,{stroke:"rgba(15, 23, 42, 0.08)",strokeDasharray:"3 3"}),(0,t.jsx)(d.XAxis,{dataKey:"time",tickLine:!1,axisLine:!1}),(0,t.jsx)(m.YAxis,{tickLine:!1,axisLine:!1}),(0,t.jsx)(c.Tooltip,{content:(0,t.jsx)(h.QueryTooltip,{timeZone:e})}),(0,t.jsx)(s.Bar,{dataKey:"under_2s",name:"<2s",stackId:"duration",fill:"var(--accent-cool)"}),(0,t.jsx)(s.Bar,{dataKey:"over_2s",name:">2s",stackId:"duration",fill:"var(--accent-hot)",radius:[10,10,4,4]})]})})})]}),(0,t.jsxs)("div",{className:"card chart-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"Query duration"}),(0,t.jsxs)("p",{className:"card-subtitle",children:["Avg vs p95 execution time (ms) - ",S]})]}),(0,t.jsx)("span",{className:"card-chip",children:B})]}),(0,t.jsxs)("div",{className:"chart-summary",children:[(0,t.jsxs)("div",{className:"chart-summary__main",children:[(0,t.jsx)("span",{className:"chart-summary__label",children:"Duration range"}),(0,t.jsx)("span",{className:"chart-summary__value",children:F}),(0,t.jsx)("span",{className:"chart-summary__meta",children:S})]}),(0,t.jsxs)("div",{className:"chart-summary__stats",children:[(0,t.jsxs)("div",{className:"chart-summary__stat",children:[(0,t.jsx)("span",{className:"legend-dot legend-dot--cool"}),(0,t.jsx)("span",{children:"Avg"}),(0,t.jsx)("strong",{children:(0,x.formatDurationMs)(O.avgAvg)})]}),(0,t.jsxs)("div",{className:"chart-summary__stat",children:[(0,t.jsx)("span",{className:"legend-dot legend-dot--gold"}),(0,t.jsx)("span",{children:"P95"}),(0,t.jsx)("strong",{children:(0,x.formatDurationMs)(O.avgP95)})]})]})]}),(0,t.jsx)("div",{className:`chart-frame${D?" chart-frame--empty":""}`,children:D?(0,t.jsx)("p",{className:"chart-empty",children:D}):(0,t.jsx)(o.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(l.LineChart,{data:R,margin:{top:10,right:20,left:0,bottom:0},syncId:"query-metrics",syncMethod:"index",children:[(0,t.jsx)(i.CartesianGrid,{stroke:"rgba(15, 23, 42, 0.08)",strokeDasharray:"3 3"}),(0,t.jsx)(d.XAxis,{dataKey:"time",tickLine:!1,axisLine:!1}),(0,t.jsx)(m.YAxis,{tickLine:!1,axisLine:!1}),(0,t.jsx)(c.Tooltip,{content:(0,t.jsx)(h.QueryTooltip,{timeZone:e}),cursor:{stroke:"var(--border)",strokeWidth:1}}),(0,t.jsx)(n.Line,{type:"monotone",dataKey:"avg_ms",name:"Avg ms",stroke:"var(--accent-cool)",strokeWidth:2,dot:!1,activeDot:{r:4,strokeWidth:2}}),(0,t.jsx)(n.Line,{type:"monotone",dataKey:"p95_ms",name:"P95 ms",stroke:"var(--accent-gold)",strokeWidth:2,dot:!1,activeDot:{r:4,strokeWidth:2}})]})})})]})]})}),(0,t.jsxs)("section",{className:"route-table route-table--compact",children:[(0,t.jsxs)("div",{className:"route-table__header",children:[(0,t.jsx)("p",{className:"route-table__title",children:"Routes"}),(0,t.jsxs)("span",{className:"route-table__meta",children:[B," window"]})]}),P?(0,t.jsx)("p",{className:"route-table__empty",children:P}):(0,t.jsx)("div",{className:"route-table__scroll",children:(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Method"}),(0,t.jsx)("th",{children:"Path"}),(0,t.jsx)("th",{children:"1/2/3xx"}),(0,t.jsx)("th",{children:"4xx"}),(0,t.jsx)("th",{children:"5xx"}),(0,t.jsx)("th",{children:"Total"}),(0,t.jsx)("th",{children:"Avg"}),(0,t.jsx)("th",{children:"P95"})]})}),(0,t.jsx)("tbody",{children:v.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:`route-method route-method--text ${(0,x.methodClassName)(e.method)}`,children:e.method?e.method.toUpperCase():"--"})}),(0,t.jsx)("td",{children:(0,x.formatRouteLabel)(e)}),(0,t.jsx)("td",{children:(0,x.formatValue)(e.status_1xx_3xx??0)}),(0,t.jsx)("td",{children:(0,h.renderStatusCell)(e.status_4xx,"warn")}),(0,t.jsx)("td",{children:(0,h.renderStatusCell)(e.status_5xx,"error")}),(0,t.jsx)("td",{children:(0,x.formatValue)(e.total??0)}),(0,t.jsx)("td",{children:(0,x.formatDurationMs)(e.avg_ms)}),(0,t.jsx)("td",{children:(0,x.formatDurationMs)(e.p95_ms)})]},`volume-${e.method??"method"}-${e.route_name??e.url??"unknown"}`))})]})})]})]})}e.s(["default",()=>p])}]);