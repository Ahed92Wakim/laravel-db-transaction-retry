(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},29228,e=>{"use strict";var t=e.i(83966),s=e.i(55706),a=e.i(85183),r=e.i(93230),i=e.i(44171),n=(0,t.generateCategoricalChart)({chartName:"LineChart",GraphicalChild:s.Line,axisComponents:[{axisType:"xAxis",AxisComp:a.XAxis},{axisType:"yAxis",AxisComp:r.YAxis}],formatAxisMap:i.formatAxisMap});e.s(["LineChart",()=>n])},27988,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(72526),r=e.i(55706),i=e.i(29228),n=e.i(44098),l=e.i(34239),c=e.i(85183),o=e.i(93230),d=e.i(30908),h=e.i(18074),m=e.i(10284);let x=(e,t)=>{let s=e?.trim(),a=null!=t&&""!=`${t}`?`${t}`:null;return s||a?s&&a?`${s} / ${a}`:s??a??"--":"--"},u=(e,t)=>{if(!e)return"--";let s=new Date(e);return Number.isNaN(s.getTime())?"--":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:t??void 0}).format(s)};function p(){let[e,p]=(0,s.useState)(null),[j,_]=(0,s.useState)("24h"),[g,N]=(0,s.useState)([]),[b,v]=(0,s.useState)("idle"),[f,y]=(0,s.useState)(null),[C,w]=(0,s.useState)(null),[A,S]=(0,s.useState)([]),[L,$]=(0,s.useState)([]),[k,T]=(0,s.useState)(null),[R,O]=(0,s.useState)("idle"),[M,U]=(0,s.useState)(1),[E,q]=(0,s.useState)(0),B=m.timeRanges.find(e=>e.value===j)??m.timeRanges[1],D=(0,s.useMemo)(()=>(0,m.resolveTimeWindow)(j),[j]),I=(0,s.useMemo)(()=>new URLSearchParams({from:D.from.toISOString(),to:D.to.toISOString(),window:j}).toString(),[j,D]),P=B.windowLabel,V=B.label;(0,s.useEffect)(()=>{"u"<typeof Intl?p("UTC"):p(Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC")},[]),(0,s.useEffect)(()=>{let e=new AbortController;return v("loading"),(async()=>{try{let t=await fetch(`${m.apiBase}/metrics/exceptions?${I}&limit=50`,{signal:e.signal,headers:{Accept:"application/json"}});if(!t.ok)return void v("error");let s=await t.json(),a=(Array.isArray(s?.data)?s.data:[]).map(e=>({...e,occurrences:(0,m.toCount)(e.occurrences??0)}));N(a),v("idle")}catch(e){"AbortError"!==e.name&&v("error")}})(),()=>e.abort()},[I]),(0,s.useEffect)(()=>{0===g.length?y(null):f&&g.some(e=>e.event_hash===f)||(y(g[0].event_hash??null),U(1))},[g,f]),(0,s.useEffect)(()=>{if(!f){w(null),S([]),$([]),T(null),q(0);return}let e=new AbortController;return O("loading"),w(null),S([]),$([]),T(null),q(0),(async()=>{try{let t=await fetch(`${m.apiBase}/metrics/exceptions/${encodeURIComponent(f)}?${I}&page=${M}&per_page=20`,{signal:e.signal,headers:{Accept:"application/json"}});if(!t.ok)return void O("error");let s=await t.json(),a=(Array.isArray(s?.data?.series)?s.data.series:[]).map(e=>({...e,count:(0,m.toCount)(e.count??0)})),r=(0,m.resolveBucket)(s?.meta?.bucket)??(0,m.bucketForRange)(j);w(s?.data?.group??null),S(Array.isArray(s?.data?.occurrences)?s.data.occurrences:[]),$(a),T(r),q((0,m.toCount)(s?.meta?.total??0)),O("idle")}catch(e){"AbortError"!==e.name&&O("error")}})(),()=>e.abort()},[M,I,f,j]);let F=g.reduce((e,t)=>e+(0,m.toCount)(t.occurrences),0),K="loading"===b?"Loading exceptions...":"error"===b?"Unable to load exception data.":0===g.length?"No exceptions logged in this window.":null,G="loading"===R?"Loading exception detail...":"error"===R?"Unable to load exception detail.":0===A.length?"No occurrences in this window.":null,W=Math.max(1,Math.ceil(E/20)),Q=(0,s.useMemo)(()=>L.map(t=>({...t,time:(0,m.formatBucketLabel)(t.timestamp,k,e,t.time)})),[e,L,k]);return(0,t.jsxs)(d.default,{timeRange:j,onTimeRangeChange:_,rangeLabel:P,children:[(0,t.jsxs)("section",{className:"route-table route-table--compact",children:[(0,t.jsxs)("div",{className:"route-table__header",children:[(0,t.jsx)("p",{className:"route-table__title",children:"DB exceptions"}),(0,t.jsxs)("span",{className:"route-table__meta",children:[V," window · ",(0,m.formatValue)(g.length)," unique ·"," ",(0,m.formatValue)(F)," total"]})]}),K?(0,t.jsx)("p",{className:"route-table__empty",children:K}):(0,t.jsx)("div",{className:"route-table__scroll",children:(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Exception"}),(0,t.jsx)("th",{children:"Error code"}),(0,t.jsx)("th",{children:"Connection"}),(0,t.jsx)("th",{children:"Route"}),(0,t.jsx)("th",{children:"Occurrences"}),(0,t.jsx)("th",{children:"Last seen"})]})}),(0,t.jsx)("tbody",{children:g.map((s,a)=>{let r=(e=>{let t=e?.trim();if(!t)return"Unknown exception";let s=t.split("\\"),a=s[s.length-1];return a&&a.length>0?a:t})(s.exception_class),i=s.exception_class?.trim(),n=s.error_message?.trim(),l=s.event_hash&&s.event_hash===f;return(0,t.jsxs)("tr",{className:`exception-row${l?" exception-row--active":""}`,onClick:()=>{s.event_hash&&(y(s.event_hash),U(1))},children:[(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"exception-cell",children:[(0,t.jsx)("span",{className:"exception-title",children:r}),i&&i!==r?(0,t.jsx)("span",{className:"exception-meta",children:i}):null,n?(0,t.jsx)("span",{className:"exception-meta",children:n}):null]})}),(0,t.jsx)("td",{className:"exception-code",children:x(s.sql_state,s.driver_code)}),(0,t.jsx)("td",{children:s.connection?.trim()||"--"}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"route-cell",children:[(0,t.jsx)("span",{className:`route-method route-method--text ${(0,m.methodClassName)(s.method)}`,children:s.method?s.method.toUpperCase():"--"}),(0,t.jsx)("span",{children:(0,m.formatRouteLabel)(s)})]})}),(0,t.jsx)("td",{children:(0,m.formatValue)(s.occurrences)}),(0,t.jsx)("td",{children:u(s.last_seen,e)})]},s.event_hash??`${r}-${a}`)})})]})})]}),f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("section",{className:"grid charts charts--pair",children:[(0,t.jsxs)("div",{className:"card chart-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"Occurrences over time"}),(0,t.jsx)("p",{className:"card-subtitle",children:P})]}),(0,t.jsx)("span",{className:"card-chip",children:V})]}),(0,t.jsx)("div",{className:`chart-frame${G?" chart-frame--empty":""}`,children:G?(0,t.jsx)("p",{className:"chart-empty",children:G}):(0,t.jsx)(n.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(i.LineChart,{data:Q,margin:{top:10,right:20,left:0,bottom:0},children:[(0,t.jsx)(a.CartesianGrid,{stroke:"rgba(15, 23, 42, 0.08)",strokeDasharray:"3 3"}),(0,t.jsx)(c.XAxis,{dataKey:"time",tickLine:!1,axisLine:!1}),(0,t.jsx)(o.YAxis,{tickLine:!1,axisLine:!1}),(0,t.jsx)(l.Tooltip,{content:(0,t.jsx)(h.ChartTooltip,{})}),(0,t.jsx)(r.Line,{type:"monotone",dataKey:"count",name:"Occurrences",stroke:"var(--accent)",strokeWidth:2,dot:!1,activeDot:{r:4,strokeWidth:2}})]})})})]}),(0,t.jsxs)("div",{className:"card exception-detail",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"Exception details"}),(0,t.jsx)("p",{className:"card-subtitle",children:"Grouped fingerprint"})]}),(0,t.jsxs)("span",{className:"card-chip",children:[(0,m.formatValue)(E)," hits"]})]}),(0,t.jsxs)("div",{className:"exception-detail__body",children:[(0,t.jsxs)("div",{className:"exception-detail__row",children:[(0,t.jsx)("span",{children:"Class"}),(0,t.jsx)("strong",{children:C?.exception_class?.trim()||"--"})]}),(0,t.jsxs)("div",{className:"exception-detail__row",children:[(0,t.jsx)("span",{children:"Message"}),(0,t.jsx)("strong",{children:C?.error_message?.trim()||"--"})]}),(0,t.jsxs)("div",{className:"exception-detail__row",children:[(0,t.jsx)("span",{children:"Error code"}),(0,t.jsx)("strong",{children:x(C?.sql_state??null,C?.driver_code??null)})]}),(0,t.jsxs)("div",{className:"exception-detail__row",children:[(0,t.jsx)("span",{children:"Connection"}),(0,t.jsx)("strong",{children:C?.connection?.trim()||"--"})]}),(0,t.jsxs)("div",{className:"exception-detail__row",children:[(0,t.jsx)("span",{children:"Last seen"}),(0,t.jsx)("strong",{children:u(C?.last_seen??null,e)})]}),(0,t.jsxs)("div",{className:"exception-detail__sql",children:[(0,t.jsx)("span",{children:"SQL"}),(0,t.jsx)("code",{children:C?.sql?.trim()||"--"})]})]})]})]}),(0,t.jsxs)("section",{className:"route-table exception-occurrences",children:[(0,t.jsxs)("div",{className:"route-table__header",children:[(0,t.jsx)("p",{className:"route-table__title",children:"Occurrences"}),(0,t.jsxs)("span",{className:"route-table__meta",children:[(0,m.formatValue)(E)," total · page ",M," of ",W]})]}),G?(0,t.jsx)("p",{className:"route-table__empty",children:G}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"route-table__scroll",children:(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Occurred"}),(0,t.jsx)("th",{children:"Route"}),(0,t.jsx)("th",{children:"User"}),(0,t.jsx)("th",{children:"SQL"}),(0,t.jsx)("th",{children:"Message"})]})}),(0,t.jsx)("tbody",{children:A.map(s=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:u(s.occurred_at,e)}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"route-cell",children:[(0,t.jsx)("span",{className:`route-method route-method--text ${(0,m.methodClassName)(s.method)}`,children:s.method?s.method.toUpperCase():"--"}),(0,t.jsx)("span",{children:(0,m.formatRouteLabel)(s)})]})}),(0,t.jsxs)("td",{children:[s.user_type?`${s.user_type}`:"--",s.user_id?` #${s.user_id}`:""]}),(0,t.jsx)("td",{className:"exception-sql",children:s.sql?.trim()||s.raw_sql?.trim()||"--"}),(0,t.jsx)("td",{className:"exception-message",children:s.error_message?.trim()||"--"})]},`${s.event_hash??"event"}-${s.id}`))})]})}),(0,t.jsxs)("div",{className:"table-footer",children:[(0,t.jsxs)("span",{className:"table-footer__meta",children:["Showing ",A.length," of ",(0,m.formatValue)(E)]}),(0,t.jsxs)("div",{className:"table-footer__actions",children:[(0,t.jsx)("button",{type:"button",className:"pagination-button",onClick:()=>U(e=>Math.max(1,e-1)),disabled:M<=1,children:"Previous"}),(0,t.jsx)("button",{type:"button",className:"pagination-button",onClick:()=>U(e=>Math.min(W,e+1)),disabled:M>=W,children:"Next"})]})]})]})]})]}):null]})}e.s(["default",()=>p])}]);