(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},9694,e=>{"use strict";var t=e.i(83966),s=e.i(75225),a=e.i(85183),i=e.i(93230),r=e.i(44171),n=(0,t.generateCategoricalChart)({chartName:"BarChart",GraphicalChild:s.Bar,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:a.XAxis},{axisType:"yAxis",AxisComp:i.YAxis}],formatAxisMap:r.formatAxisMap});e.s(["BarChart",()=>n])},37500,e=>{"use strict";var t=e.i(43476),s=e.i(22016),a=e.i(71645),i=e.i(18566),r=e.i(75225),n=e.i(9694),c=e.i(72526),l=e.i(44098),o=e.i(34239),d=e.i(85183),m=e.i(93230),h=e.i(30908),u=e.i(18074),x=e.i(10284);let p=["30d","7d","24h"],j=(e,t)=>{if(!e)return"--";let s=new Date(e);return Number.isNaN(s.getTime())?"--":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:t??void 0}).format(s)};function _(){let e=(0,i.useSearchParams)(),_=e.get("eventHash"),[g,f]=(0,a.useState)(null),[v,N]=(0,a.useState)("24h"),[w,y]=(0,a.useState)(null),[b,S]=(0,a.useState)([]),[C,T]=(0,a.useState)([]),[A,k]=(0,a.useState)(null),[O,R]=(0,a.useState)("idle"),[B,I]=(0,a.useState)(1),[E,M]=(0,a.useState)(0),[$,L]=(0,a.useState)({"30d":0,"7d":0,"24h":0}),[D,U]=(0,a.useState)("idle"),P=x.timeRanges.find(e=>e.value===v)??x.timeRanges[1],V=(0,a.useMemo)(()=>(0,x.resolveTimeWindow)(v),[v]),F=(0,a.useMemo)(()=>new URLSearchParams({from:V.from.toISOString(),to:V.to.toISOString(),window:v}).toString(),[v,V]),K=P.windowLabel,q=P.label;(0,a.useEffect)(()=>{"u"<typeof Intl?f("UTC"):f(Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC")},[]),(0,a.useEffect)(()=>{let t=e.get("window");t&&x.timeRanges.some(e=>e.value===t)&&N(e=>e===t?e:t)},[e]),(0,a.useEffect)(()=>{I(1)},[_,v]),(0,a.useEffect)(()=>{if(!_){y(null),S([]),T([]),k(null),M(0),L({"30d":0,"7d":0,"24h":0}),U("idle"),R("idle");return}let e=new AbortController;return R("loading"),y(null),S([]),T([]),k(null),M(0),(async()=>{try{let t=await fetch(`${x.apiBase}/metrics/exceptions/${encodeURIComponent(_)}?${F}&page=${B}&per_page=20`,{signal:e.signal,headers:{Accept:"application/json"}});if(!t.ok)return void R("error");let s=await t.json(),a=(Array.isArray(s?.data?.series)?s.data.series:[]).map(e=>({...e,count:(0,x.toCount)(e.count??0)})),i=(0,x.resolveBucket)(s?.meta?.bucket)??(0,x.bucketForRange)(v);y(s?.data?.group??null),S(Array.isArray(s?.data?.occurrences)?s.data.occurrences:[]),T(a),k(i),M((0,x.toCount)(s?.meta?.total??0)),R("idle")}catch(e){"AbortError"!==e.name&&R("error")}})(),()=>e.abort()},[_,B,F,v]),(0,a.useEffect)(()=>{if(!_)return;let e=new AbortController;return U("loading"),L({"30d":0,"7d":0,"24h":0}),(async()=>{try{let t=(await Promise.all(p.map(async t=>{let s,a=await fetch(`${x.apiBase}/metrics/exceptions/${encodeURIComponent(_)}?${(s=(0,x.resolveTimeWindow)(t),new URLSearchParams({from:s.from.toISOString(),to:s.to.toISOString(),window:t}).toString())}&page=1&per_page=1`,{signal:e.signal,headers:{Accept:"application/json"}});if(!a.ok)return[t,0];let i=await a.json();return[t,(0,x.toCount)(i?.meta?.total??0)]}))).reduce((e,[t,s])=>(e[t]=s,e),{"30d":0,"7d":0,"24h":0});L(t),U("idle")}catch(e){"AbortError"!==e.name&&(U("error"),L({"30d":0,"7d":0,"24h":0}))}})(),()=>e.abort()},[_]);let G=_?"loading"===O?"Loading exception detail...":"error"===O?"Unable to load exception detail.":0===b.length?"No occurrences in this window.":null:"Select an exception from the DB exceptions list.",W=Math.max(1,Math.ceil(E/20)),X=(0,a.useMemo)(()=>C.map(e=>({...e,time:(0,x.formatBucketLabel)(e.timestamp,A,g,e.time)})),[g,C,A]),Y=(e=>{let t=e?.trim();if(!t)return"Unknown exception";let s=t.split("\\"),a=s[s.length-1];return a&&a.length>0?a:t})(w?.exception_class??null),Z=`/db-exceptions?window=${v}`,H=_?_.slice(0,12):"--",Q=(e=>{if(!e)return"--";let t=new Date(e);if(Number.isNaN(t.getTime()))return"--";let s=Date.now(),a=t.getTime()-s,i=Math.abs(a),r=new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}),n=[{unit:"year",ms:31536e6},{unit:"month",ms:2592e6},{unit:"week",ms:6048e5},{unit:"day",ms:864e5},{unit:"hour",ms:36e5},{unit:"minute",ms:6e4}],c=n.find(e=>i>=e.ms)??n[n.length-1],l=Math.round(a/c.ms);return r.format(l,c.unit)})(w?.last_seen??null),z=j(V.from.toISOString(),g),J=(0,a.useMemo)(()=>{let e=C.filter(e=>e.count>0&&e.timestamp).sort((e,t)=>new Date(e.timestamp??"").getTime()-new Date(t.timestamp??"").getTime())[0];return e?.timestamp?j(e.timestamp,g):z},[g,C,z]),ee=w?.error_message?.trim()||"No message recorded.";return(0,t.jsx)(h.default,{timeRange:v,onTimeRangeChange:N,rangeLabel:K,children:(0,t.jsxs)("div",{className:"exception-detail-page",children:[(0,t.jsxs)("header",{className:"exception-hero",children:[(0,t.jsx)("p",{className:"exception-hero__eyebrow",children:"Exceptions"}),(0,t.jsxs)("div",{className:"exception-hero__row",children:[(0,t.jsxs)("div",{className:"exception-hero__main",children:[(0,t.jsx)("h1",{className:"exception-hero__title",children:Y}),(0,t.jsx)("p",{className:"exception-hero__message",children:ee}),(0,t.jsxs)("p",{className:"exception-hero__meta",children:[q," window · event ",H," · last seen ",Q]})]}),(0,t.jsxs)("div",{className:"exception-hero__actions",children:[(0,t.jsxs)("div",{className:"exception-hero__pill",children:[(0,x.formatValue)(E)," issue",1===E?"":"s"]}),(0,t.jsx)(s.default,{className:"exceptions-filter exceptions-filter--active",href:Z,children:"Back to DB exceptions"})]})]})]}),(0,t.jsxs)("section",{className:"exception-top-grid",children:[(0,t.jsxs)("div",{className:"card exception-summary",children:[(0,t.jsxs)("div",{className:"exception-summary__section",children:[(0,t.jsx)("p",{className:"exception-summary__title",children:"Info"}),(0,t.jsxs)("div",{className:"exception-summary__rows",children:[(0,t.jsxs)("div",{className:"exception-summary__row",children:[(0,t.jsx)("span",{children:"Last seen"}),(0,t.jsx)("strong",{children:Q})]}),(0,t.jsxs)("div",{className:"exception-summary__row",children:[(0,t.jsx)("span",{children:"First seen"}),(0,t.jsx)("strong",{children:J})]}),(0,t.jsxs)("div",{className:"exception-summary__row",children:[(0,t.jsx)("span",{children:"Window start"}),(0,t.jsx)("strong",{children:z})]}),(0,t.jsxs)("div",{className:"exception-summary__row",children:[(0,t.jsx)("span",{children:"Occurrences"}),(0,t.jsx)("strong",{children:(0,x.formatValue)(E)})]})]})]}),(0,t.jsx)("div",{className:"exception-summary__divider"}),(0,t.jsxs)("div",{className:"exception-summary__section",children:[(0,t.jsx)("p",{className:"exception-summary__title",children:"Impact"}),(0,t.jsx)("p",{className:"exception-summary__subtitle",children:"loading"===D?"Refreshing impact...":"Impact over fixed windows"}),(0,t.jsxs)("div",{className:"exception-summary__rows",children:[(0,t.jsxs)("div",{className:"exception-summary__row",children:[(0,t.jsx)("span",{children:"Events (30 days)"}),(0,t.jsx)("strong",{children:(0,x.formatValue)($["30d"])})]}),(0,t.jsxs)("div",{className:"exception-summary__row",children:[(0,t.jsx)("span",{children:"Events (7 days)"}),(0,t.jsx)("strong",{children:(0,x.formatValue)($["7d"])})]}),(0,t.jsxs)("div",{className:"exception-summary__row",children:[(0,t.jsx)("span",{children:"Events (24 hours)"}),(0,t.jsx)("strong",{children:(0,x.formatValue)($["24h"])})]})]})]})]}),(0,t.jsxs)("div",{className:"card exception-trend",children:[(0,t.jsxs)("div",{className:"exception-trend__header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"card-title",children:"Occurrences"}),(0,t.jsx)("p",{className:"card-subtitle",children:K})]}),(0,t.jsxs)("div",{className:"exception-trend__totals",children:[(0,t.jsx)("span",{className:"exception-trend__count",children:(0,x.formatValue)(E)}),(0,t.jsx)("span",{className:"card-chip",children:q})]})]}),(0,t.jsx)("div",{className:`chart-frame exception-trend__chart${G?" chart-frame--empty":""}`,children:G?(0,t.jsx)("p",{className:"chart-empty",children:G}):(0,t.jsx)(l.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(n.BarChart,{data:X,margin:{top:8,right:8,left:-12,bottom:0},children:[(0,t.jsx)(c.CartesianGrid,{stroke:"var(--grid)",strokeDasharray:"3 3",vertical:!1}),(0,t.jsx)(d.XAxis,{dataKey:"time",tickLine:!1,axisLine:!1,minTickGap:24}),(0,t.jsx)(m.YAxis,{tickLine:!1,axisLine:!1,allowDecimals:!1}),(0,t.jsx)(o.Tooltip,{content:(0,t.jsx)(u.ChartTooltip,{})}),(0,t.jsx)(r.Bar,{dataKey:"count",name:"Occurrences",fill:"var(--accent-strong)",radius:[6,6,0,0]})]})})})]})]}),(0,t.jsx)("section",{className:"exception-bottom-grid",children:(0,t.jsxs)("section",{className:"route-table exception-occurrences exception-occurrences--nightwatch",children:[(0,t.jsxs)("div",{className:"route-table__header",children:[(0,t.jsx)("p",{className:"route-table__title",children:"Occurrences"}),(0,t.jsxs)("span",{className:"route-table__meta",children:[(0,x.formatValue)(E)," total · page ",B," of ",W]})]}),G?(0,t.jsx)("p",{className:"route-table__empty",children:G}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"route-table__scroll",children:(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Occurred"}),(0,t.jsx)("th",{children:"User"}),(0,t.jsx)("th",{children:"SQL"})]})}),(0,t.jsx)("tbody",{children:b.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:j(e.occurred_at,g)}),(0,t.jsxs)("td",{children:[e.user_type?`${e.user_type}`:"--",e.user_id?` #${e.user_id}`:""]}),(0,t.jsx)("td",{className:"exception-sql",children:e.raw_sql?.trim()||e.sql?.trim()||"--"})]},`${e.event_hash??"event"}-${e.id}`))})]})}),(0,t.jsxs)("div",{className:"table-footer",children:[(0,t.jsxs)("span",{className:"table-footer__meta",children:["Showing ",b.length," of ",(0,x.formatValue)(E)]}),(0,t.jsxs)("div",{className:"table-footer__actions",children:[(0,t.jsx)("button",{type:"button",className:"pagination-button",onClick:()=>I(e=>Math.max(1,e-1)),disabled:B<=1,children:"Previous"}),(0,t.jsx)("button",{type:"button",className:"pagination-button",onClick:()=>I(e=>Math.min(W,e+1)),disabled:B>=W,children:"Next"})]})]})]})]})})]})})}e.s(["default",()=>_])}]);